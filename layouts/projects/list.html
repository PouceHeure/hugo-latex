{{ define "main" }}
    <div class="container min-vh-100">
        
        <!-- Tags Section Above Cards -->
        <section class="tags-container p-3 rounded mb-4">
            <div class="d-flex align-items-center flex-wrap">
                <h5 class="title-tags text-secondary mb-0 me-3 flex-shrink-0">üè∑Ô∏è Tags</h5>
                <div id="tagButtons" class="d-flex flex-wrap gap-2">
                    {{ $projectTags := slice }}
                    {{ range where .Site.RegularPages "Section" "projects" }}
                        {{ range .Params.tags }}
                            {{ $tag := . | lower }}
                            {{ if not (in $projectTags $tag) }}
                                {{ $projectTags = $projectTags | append $tag }}
                            {{ end }}
                        {{ end }}
                    {{ end }}
                    
                    <!-- Display each tag as a clickable filter button -->
                    {{ range $projectTags }}
                        <a href="#" class="badge tag-link btn btn-outline-primary btn-sm text-primary">#{{ . }}</a>
                    {{ end }}
                </div>
            </div>
        </section>
        
        

        <!-- Main Content with Project Cards -->
        <article class="">
            {{ $prevYear := "" }}
            {{ range (sort .Pages "Date" "desc") }}
                {{ $currentYear := .Date.Format "2006" }}
                {{ if ne $currentYear $prevYear }}
                    {{ if ne $prevYear "" }}
                        </div> <!-- Close previous year's grid -->
                    {{ end }}
                    <h2 class="text-secondary mt-4">{{ $currentYear }}</h2>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 projectList">
                    {{ $prevYear = $currentYear }}
                {{ end }}
                
                <!-- Individual project card -->
                <div class="col">
                    <div class="card p-3 d-flex flex-column shadow h-100">
                        <h6 class="card-title">
                            <h5 class="text-primary">
                                <a href="{{ .RelPermalink }}" class="text-decoration-none text-primary">{{ if .Params.pinned }}<span class="emoji">‚òÜ</span>{{ end }} {{ .Title }}</a>
                            </h5>
                        </h6>
                        <p class="text-muted small">üóìÔ∏è {{ .Date.Format "02 January 2006" }}</p>
                        
                        <!-- Display project tags -->
                        <div class="tags mb-2 d-flex flex-wrap gap-1">
                            {{ range .Params.tags }}
                                <span class="badge bg-secondary px-2 py-1">{{ . | lower }}</span>
                            {{ end }}
                        </div>
                        <div class="mt-auto">
                            <a href="{{ .RelPermalink }}" class="btn btn-primary btn-sm">Read More</a>
                        </div>
                    </div>
                </div>
            {{ end }}
            </div> <!-- Close last year's grid -->
        </article>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const tagLinks = document.querySelectorAll(".tag-link");
            const cards = document.querySelectorAll(".card");
            let activeTag = "All";

            tagLinks.forEach(link => {
                link.addEventListener("click", function(event) {
                    event.preventDefault();
                    const selectedTag = this.textContent.replace('#', '').trim();
                    
                    if (activeTag === selectedTag) {
                        this.classList.remove("btn-primary", "text-light");
                        this.classList.add("btn-outline-primary", "text-primary");
                        activeTag = "All";
                        showAllCards();
                    } else {
                        tagLinks.forEach(a => {
                            a.classList.remove("btn-primary", "text-light");
                            a.classList.add("btn-outline-primary", "text-primary");
                        });
                        this.classList.remove("btn-outline-primary", "text-primary");
                        this.classList.add("btn-primary", "text-light");
                        activeTag = selectedTag;
                        filterCards(selectedTag);
                    }
                });
            });

            function showAllCards() {
                cards.forEach(card => {
                    card.parentElement.style.display = "block";
                });
            }

            function filterCards(tag) {
                cards.forEach(card => {
                    const cardTags = Array.from(card.querySelectorAll(".badge")).map(tag => tag.textContent.trim().toLowerCase());
                    if (cardTags.includes(tag.toLowerCase())) {
                        card.parentElement.style.display = "block";
                    } else {
                        card.parentElement.style.display = "none";
                    }
                });
            }
        });
    </script>

<style>
    /* Style for the tags section */

    .title-tags {
        font-size: 18px;
        font-weight: bold;
        /* color: #333; */
        /* text-align: center; */
        padding-bottom: 10px;
        /* border-bottom: 2px solid var(--bs-primary); */
    }

</style>

{{ end }}
