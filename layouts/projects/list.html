{{ define "main" }}

<!-- Container for Full Page -->
<div class="container min-vh-100">

  <!-- Section: Tags Filter Buttons -->
  <section class="tags-container p-3 rounded d-none d-sm-flex">
    <div class="d-flex align-items-center flex-wrap">
      <!-- Tag buttons auto-generated from project tags -->
      <div id="tagButtons" class="d-flex flex-wrap gap-2">
        {{ $projectTags := slice }}
        {{ range where .Site.RegularPages "Section" "projects" }}
          {{ range .Params.tags }}
            {{ $tag := . | lower }}
            {{ if not (in $projectTags $tag) }}
              {{ $projectTags = $projectTags | append $tag }}
            {{ end }}
          {{ end }}
        {{ end }}
        {{ $projectTags = sort $projectTags }}

        {{ range $projectTags }}
          <a href="#" class="badge tag-link btn btn-outline-primary btn-sm text-primary shadow-sm">
            <i class="bi bi-tag me-1"></i>{{ partial "tagrepr.html" . }}
          </a>
        {{ end }}
      </div>    
    </div>
  </section>

  <div id="selectedTagDisplay" class="m-3 mt-0 d-none d-flex align-items-center gap-2">
    <span class="badge bg-primary text-dark p-2 fs-6 d-flex align-items-center">
  <i class="bi bi-tag me-1"></i>
  <strong id="selectedTagName" class="me-2"></strong>
  <button id="clearSelectedTag" type="button" class="btn-close btn-close-white ml-3" aria-label="Clear tag"></button>
</span>

    <!-- <div>
    <button type="button" class="btn-close-white ml-3"></button>
  </div> -->

  </div>

  <!-- Section: Project Cards Grouped by Year -->
  <article class="tags-container rounded mb-4">
    {{ $prevYear := "" }}
    {{ range (sort .Pages "Date" "desc") }}
      {{ $currentYear := .Date.Format "2006" }}
      {{ if ne $currentYear $prevYear }}
        {{ if ne $prevYear "" }}</div>{{ end }} <!-- Close previous year's grid -->

        <h2 class="text-primary mt-4 m-3">{{ $currentYear }}</h2>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 projectList">
        {{ $prevYear = $currentYear }}
      {{ end }}

      <!-- Single Project Card -->
      <div class="col mb-3 mb-sm-0">
        {{ $cardClass := "card p-3 d-flex flex-column shadow h-100 card-transparent position-relative overflow-hidden" }}
        {{ with .Params.image }}
          {{ $cardClass = printf "%s %s" $cardClass "card_image" }}
        {{ end }}

        <div class="{{ $cardClass }}"
          {{ with .Params.image }}
            style="background-image: url('{{ . }}'); background-size: cover; background-position: center;"
          {{ end }}>

          <!-- Project Title -->
          <h5 class="text-primary">
            <span class="project-title-bg">
              <a href="{{ .RelPermalink }}" class="text-decoration-none text-primary">
                {{ if .Params.pinned }}<span class="emoji">â˜†</span>{{ end }} {{ .Title }}
              </a>
            </span>
          </h5>

          <!-- Optional Description -->
          {{ with .Params.description }}
            <p class="text-muted small mb-2">{{ . }}</p>
          {{ end }}

          <!-- Date -->
          <p class="text-muted small">
            <i class="bi bi-calendar-event me-1"></i> {{ .Date.Format "02 January 2006" }}
          </p>

          <!-- Tags -->
          <div class="tags mb-2 d-flex justify-content-left flex-wrap">
            {{ range .Params.tags }}
          <span class="badge bg-secondary me-1 mb-1">
            <i class="bi bi-tag me-1"></i>{{ partial "tagrepr.html" . }}
          </span>
        {{ end }}

            <!-- Code Languages -->
            {{ with .Params.codelang }}
              {{ range . }}
                <span class="badge bg-info text-dark me-1 mb-1">
                  <i class="bi bi-code-slash me-1"></i>{{ . }}
                </span>
              {{ end }}
            {{ end }}
          </div>

          <!-- Action Button -->
          <div class="mt-auto">
            <a href="{{ .RelPermalink }}" class="btn btn-primary btn-sm">Read More</a>
          </div>
        </div>
      </div>
    {{ end }}
    </div> <!-- Close last year's grid -->
  </article>
</div>

<!-- JavaScript Section: Filter Projects by Tag -->
<script src="/js/card-tags-filter.js"></script>

{{ end }}
