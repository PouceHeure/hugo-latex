{{/* Vérifier si le compteur existe déjà pour cette page, sinon l'initialiser */}}
{{ $figNum := .Page.Scratch.Get "figCounter" | default 0 }}
{{ $figNum = add $figNum 1 }}
{{ .Page.Scratch.Set "figCounter" $figNum }}

{{ $images := split (.Get "images") "," }} 
{{ $captions := split (.Get "captions") "," }}

<div class="row justify-content-center">
    {{ $numImages := len $images }}
    {{ $colClass := "col-md-4 col-sm-6 col-12" }} <!-- Par défaut : 3 images max en ligne -->

    {{ if eq $numImages 1 }}
        {{ $colClass = "col-12" }} <!-- 1 image = pleine largeur -->
    {{ else if eq $numImages 2 }}
        {{ $colClass = "col-md-6 col-sm-6 col-12" }} <!-- 2 images = 50% chacune sur desktop -->
    {{ else if eq $numImages 3 }}
        {{ $colClass = "col-md-4 col-sm-6 col-12" }} <!-- 3 images = 1/3 chacune -->
    {{ else if eq $numImages 4 }}
        {{ $colClass = "col-md-3 col-sm-6 col-12" }} <!-- 4 images = 1/4 chacune -->
    {{ end }}

    {{ range $index, $image := $images }}
        {{ $image = trim $image " " }}
        <div class="{{ $colClass }} text-center">
            <figure>
                <img src="{{ $image }}" alt="{{ index $captions $index | default "" }}" class="img-fluid">
                {{ if lt $index (len $captions) }}
                    <figcaption class="text-muted">Fig. {{ $figNum }}.{{ add $index 1 }} - {{ index $captions $index }}</figcaption>
                {{ end }}
            </figure>
        </div>
    {{ end }}
</div>
